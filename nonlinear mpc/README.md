
# Nonlinear MPC Example

This folder contains a Nonlinear Model Predictive Control (NMPC) example for a two-link manipulator. It includes the NMPC setup, state and output functions, Jacobian generation scripts, obstacle constraint functions and plotting utilities.

Files

- `main.m` — main script that sets up the NMPC controller, generates reference trajectories and runs the simulation.
- `StateFcn.m` — continuous-time state function f(x,u) used by the NMPC model.
- `OutputFcn.m` — output function y = h(x,u) used by the NMPC model.
- `JacStateFcn.m`, `JacOutputFcn.m` — functions that return Jacobians of the state and output functions (used by the NMPC solver).
- `generateJacobian.m` — symbolic script that computes the Jacobians and saves `Jacobian.mat` with callable functions.
- `Jacobian.mat` — saved Jacobian function handles (generated by `generateJacobian.m`).
- `trace_figures.m` — plotting script to visualize results (states, inputs, errors, obstacle checks, computation time, cost, etc.).
- `helperRobotEnvironment.m` — helper to draw and animate the robot manipulator.
- `ceiling.m`, `circle.m` — custom inequality constraint functions used to encode obstacle avoidance constraints for the NMPC.

How to run

1. Open MATLAB and set this folder as the current working directory (or add it to the MATLAB path).
2. If the Jacobian functions are not present or up-to-date, run `generateJacobian.m` to build `Jacobian.mat`.
3. Optionally review `main.m` to set physical parameters, obstacle type ("ceiling" or "circle"), horizons and simulation time.
4. Run `main.m` from the MATLAB command window. The script will configure the `nlmpc` object, run the closed-loop NMPC simulation and then call `trace_figures.m` to plot results.

Requirements

- MATLAB (R2019b or newer recommended)
- Model Predictive Control Toolbox (for `nlmpc`)
- Symbolic Math Toolbox (only required to run `generateJacobian.m`)
- (Optional) Additional toolboxes if you extend the Simulink/visualization utilities

Notes

- `generateJacobian.m` uses symbolic variables and saves function handles to `Jacobian.mat`. If you change the dynamic model, re-run this script.
- The constraint functions `ceiling.m` and `circle.m` are referenced by `main.m` through `mpcobj.Optimization.CustomIneqConFcn`.
- Plotting scripts use LaTeX interpreters for labels; adjust if necessary for your MATLAB setup.
